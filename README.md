# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс для данных товара

```
interface ICardDate {
	id: string;
	description: string | string[];
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

Карточка товара

```
interface ICard extends ICardDate {
	index?: string;
	buttonName?: string;
}
```

Состояние приложения

```
interface IAppState {
	catalog: ICard[];
	basket: ICard[];
	preview: string | null;
	order: IOrder | null;
	loading: boolean;
	formErrors: FormErrors;
}
```

Интерфейс для формы доставки

```
interface IOrderDelivery {
	payment: TPayment;
	address: string;
}
```

Интерфейс для контактной формы

```
interface IOrderContacts {
	email: string;
	phone: string;
}
```

Интерфейс для данных заказа

```
interface IOrder extends IOrderDelivery, IOrderContacts {
	total: number;
	items: string[];
}
```

Интерфейс для успешного выполнения операции

```
interface ISuccess {
	total: number;
}
```

---

## Архитектура приложения:

Приложение построено на основе паттерна MVP (Model-View-Presenter) и состоит из трех основных слоев:

- `Модель (Model)` - отвечает за хранение и обработку данных.
- `Представление (View) ` - отвечает за отображение данных и взаимодействие с пользователем.
- `Презентер (Presenter)` - связывает Модель и Представление, обрабатывает логику приложения и реагирует на события от Представления..

---

### Базовый код

### 1. API - Это базовый класс, который отвечает за работу с сервером.

#### Конструктор класса:

- `baseUrl: string` - принимает `URL`.
- `options: RequestInit` - опции для доступа к различным параметрам.

#### Методы класса:

- `handleResponse(response: Response): Promise<object>` - обрабатывает ответ от сервера
- `get(url: string)` - для получения данных с сервера
- `post(url: string, data: object, method: ApiPostMethods = 'POST')` - для отправки данных на сервер

### 2. EventEmitter - Наблюдатель.

- `on` - установить обработчик на событие
- `off` - снять обработчик с события
- `emit` - инициировать событие с данными
- `onAll` - слушать все события
- `offAll` - сбросить все обработчики
- `trigger` - создает коллбек триггер, генерирующий событие при вызов

### 3. Component - Является основой для компонентов проекта.

#### Конструктор класса:

- `constructor(protected readonly container: HTMLElement)` - принимает DOM элемент для работы в дочерних компонентах

#### Методы класса:

- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - используем для переключения класса компонента
- `setText(element: HTMLElement, value: unknown)` - устанавливает текстовое содержимое
- `setDisabled(element: HTMLElement, state: boolean)` - определяет нужна блокировка или нет
- `setHidden(element: HTMLElement)` - скрывает элемент
- `setVisible(element: HTMLElement)` - показывает элемент удаляя свойство display = 'none'
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - устанавливает изображение с альтернативным текстом.
- `render(data?: Partial<T>): HTMLElement` - возвращает корневой DOM-элемент.

---

### Слой данных

#### Класс AppState

Класс предстваляющий состояние приложения, включая данные каталога, предпросмотра, корзины, заказа и ошибок формы.

#### Методы:

- `clearBasket` - Очищаем корзину.
- `clearOrder` - Очищаем данные заказа.
- `setCatalog` - Устанавливает каталог товаров.
- `setPreview` - Устанавливает предпросомотр товара.
- `addToCardBasket` - Добавляет товар в корзину.
- `deleteCardBasket` - Удаляет товар из корзины.
- `basketChange` - Генерируем событие обновление корзины.
- `getTotal` - Вернуть общую сумму заказов.

#### Класс WebLarekApi

Класс расширяет базовый класс Api

#### Конструктор класса:

`constructor(cdn: string, baseUrl: string, options?: RequestInit)` - принимает ссылку для загрузки изображений товаров,базовою ссылку на API, список настроек запроса.

#### Методы:

- `getProductsList(): Promise<ICard[]>` - Получить с сервера все товары.
- `orderProduct(order: IOrder): Promise<IOrderResult>` - Отправка на сервер заказа.

#### Свойства класса:

- `cdn(string)` — ссылка для загрузки изображений продуктов.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

#### Конструктор класса:

`constructor(container: HTMLElement, protected events: IEvents)` - принимает контейнер для модального окна и объект для управления событиями.

#### Методы:

- `set content` - Задает содержимое модального окна.
- `open` - Открытие модального окна.
- `close` - Закрытие модального окна.
- `closeEsc(evt: KeyboardEvent)` - Закрывает модальное окно при нажати ESC.
- `render(data: IModal): HTMLElement` - Рендерит модальное окно.

#### Класс Form

Класс, предназначенный для формирования и управления формами.

#### Конструктор класса:

`constructor(protected container: HTMLFormElement, protected events: IEvents)` - принимает контейнер формы и объект для управления событиями.

#### Методы:

- `onInputChange(field: keyof T, value: string)` - Обработчик событий ввода, который генерирует события изменения для каждого поля в форме.
- `set valid(value: boolean)` - Контролирует активность кнопки отправки в зависимости от валидности формы.
- `set errors(value: string)` - Устанавливает и отображает ошибки валидации формы.
- `render(state: Partial<T> & IFormState)` - Отображает состояние формы, устанавливая ее валидность, обрабатывая ошибки и устанавливая значения полей

#### Класс Page

Класс управляет основными элементами интерфейса страницы.

#### Конструктор класса:

`constructor(container: HTMLElement, protected events: IEvents)`- Инициализирует элементы страницы и назначает обработчики событий.

#### Методы:

- `set counter(value: number)` - уставливает счетчик товаров в корзине.
- `set catalog(items: HTMLElement[])` - Заполняет каталог продуктов.
- `set lockScroll(value: boolean)` - Управляет блокировкой страницы.

#### Свойства класса:

- `_counter` - Элемент счетчика корзины.
- `_catalog` - Контейнер для элементов каталога продуктов.
- `_wrapper` - Обертка страницы.
- `_basket` - Элемент корзины.

#### Класс Card

Класс предназначенный для отображения и управления карточками товара.

#### Конструктор класса:

```
constructor(
protected blockName: string,
container: HTMLElement,
actions?: ICardActions
) - Инициализирует элементы карточки и устанавливает обработчики событий для кнопок.
```

#### Методы:

- `set/get id` - управляет индификатором карточки.
- `set/get title` - управляет названием товара.
- `set description` - устанавливает описание товара.
- `set/get price` - управляет ценой товара.
- `set image` - устанавливает изображение товара.
- `set/get index` - управляет index товара.
- `set buttonName` - устанавливает текст кнопки.
- `set/get category` - управляет категорией и ее цветом.
- `disableButton` - если цена не указана, то код проверяет это и делает кнопку покупки неактивной.

#### Свойства класса:

- `_title` - Название товара.
- `_description` - Описание товара.
- `_category` - Категория товара.
- `_image` - Картинка товара.
- `_price` - Цена товара.
- `_index` - Индекс товара.
- `_button` - Кнопка товара.
- `_buttonName` - текст кнопки товара.

#### Класс Basket

Класс для отображения и управления компонентом корзина. Обеспечивает отображение товаров, управление и общей стоимостью.

#### Конструктор класса:

`constructor(container: HTMLElement, protected events: EventEmitter)` - Инициализирует элементы управления корзины и подписывается на события.

#### Методы класса

- `set items(items: HTMLElement[])` - Устанавливаем данные в корзину.
- `set total(total: number)` - Устанавливаем общую сумму товаров в корзине.
- `set selected(items: number) `- Отключием кнопку оформления заказа если корзина пустая.

#### Свойства класса:

- `_list` - Список товаров в корзине.
- `_total` - Отображения общей стоимости товаров.
- `_button` - Кнопка перехода к оформлению заказа.

### Класс OrderDeliveryForm

Класс включает в себя элементы управления для выбора способа оплаты и ввода адреса доставки.

#### Конструктор класса:

`constructor(container: HTMLFormElement, events: IEvents, actions?: IActions)` - Инициализирует элементы управления формы и устанавливает обработчики событий.

#### Методы класса:

- `toggleButton(target: HTMLElement)` - Переключает активное состояние кнопок способа оплаты;
- `resetPaymentMethod()` - Сбрасывает способ оплаты к значению по умолчанию
- `set address(value: string)` - Установка адреса доставки.

#### Свойства класса:

- `_buttonCard` - Кнопка выбора оплаты картой.
- `_buttonCash` - Кнопка оплаты наличными.

#### Класс OrderContactForm

Класс для управления формой контактов.

#### Конструктор класса:

`constructor(container: HTMLFormElement, events: IEvents)` - принимает контейнер формы доставки и объект для управления событиями.

#### Методы класса:

- `set phone(value: string)` - Установка номера телефона.
- `set email(value: string)` - Установка адреса электронной почты.

#### Класс Success

Класс для отображания сообщения об успешном заказе.

#### Конструктор класса:

`constructor(container: HTMLElement, action?: ISuccessActions)` - Инициализирует элементы интерфейса и назначает обработчики событий.

#### Методы класса:

- `set total(value: string)` - Установка текста итоговой информации.

---

### Взаимодействие компонентов:

Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список всех событий:

- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `items:changed` - изменение каталога товаров
- `card:select` - выбор карточки для отображения в модальном окне
- `card:add` - добавление карточки в корзину
- `card:delete` - удаление карточки из корзины
- `preview:changed` - открытие окна карточки
- `basket:open` - открыть корзину
- `basket:change` - изменение корзины и обновление счетчика
- `order:open` - открытие модального окна адреса доставки
- `order:submit` - отправка формы доставки
- `contacts:submit` - отправка формы контактов
- `formErrors:change` - изменилось состояние валидации формы
- `payment:changed` - изменение способа оплаты
